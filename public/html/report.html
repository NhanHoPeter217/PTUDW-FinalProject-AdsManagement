<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Form Báo Cáo</title>
    <!-- Bootstrap Font Icon CSS -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css"
    />
    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <!-- Custom CSS -->
    <link rel="stylesheet" href="../css/report.css" />
    <!-- reCAPTCHA script -->
    <script src="https://www.google.com/recaptcha/api.js" async defer></script>
  </head>
  <body>
    <div class="container-fluid">
      <!-- Button to trigger the modal -->
      <button
        type="button"
        class="btn btn-primary"
        data-bs-toggle="modal"
        data-bs-target="#reportModal"
      >
        Báo cáo vi phạm
      </button>

      <!-- Modal -->
      <div
        class="modal fade"
        id="reportModal"
        tabindex="-1"
        aria-labelledby="reportModalLabel"
        aria-hidden="true"
      >
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <span id="boot-icon" class="bi bi-exclamation-triangle"></span>
              <h5 class="modal-title" id="reportModalLabel">Báo cáo vi phạm</h5>
              <button
                type="button"
                class="btn-close"
                data-bs-dismiss="modal"
                aria-label="Close"
              ></button>
            </div>
            <div class="modal-body">
              <form class="report-form" id="reportForm">
                <div class="mb-3">
                  <label for="reportType" class="form-label">Hình thức</label>
                  <select class="form-select" id="reportType" required>
                    <option value="" disabled selected>
                      -- Chọn hình thức báo cáo --
                    </option>
                    <option value="Tố giác sai phạm">Tố giác sai phạm</option>
                    <option value="Đăng ký nội dung">Đăng ký nội dung</option>
                    <option value="Đóng góp ý kiến">Đóng góp ý kiến</option>
                    <option value="Giải đáp thắc mắc">Giải đáp thắc mắc</option>
                  </select>
                </div>
                <div class="mb-3">
                  <label for="fullName" class="form-label">Họ và tên</label>
                  <input
                    type="text"
                    class="form-control"
                    id="fullName"
                    required
                  />
                </div>
                <div class="mb-3">
                  <label for="email" class="form-label">Email</label>
                  <input
                    type="email"
                    class="form-control"
                    id="email"
                    required
                  />
                </div>
                <div class="mb-3">
                  <label for="phone" class="form-label"
                    >Số điện thoại liên lạc</label
                  >
                  <input type="tel" class="form-control" id="phone" required />
                </div>
                <div class="mb-3">
                  <label for="reportContent" class="form-label">Nội dung</label>
                  <textarea id="reportContent" required></textarea>
                </div>
                <div class="mb-3">
                  <label for="image1" class="form-label">Hình ảnh 1</label>
                  <input
                    type="file"
                    class="form-control"
                    id="image1"
                    accept="image/*"
                  />
                </div>
                <div class="mb-3">
                  <label for="image2" class="form-label">Hình ảnh 2</label>
                  <input
                    type="file"
                    class="form-control"
                    id="image2"
                    accept="image/*"
                  />
                </div>

                <div class="button-container">
                  <div id="recaptcha" class="g-recaptcha" data-sitekey="6Lc_OSwpAAAAAKbiLyvfB0hp7ORpvoRcMqTXv7qb" data-callback="onSubmit" data-size="invisible"></div>
                  <button type="button" class="submit-btn" onclick="submitForm()">Gửi</button>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Bootstrap JS and Popper.js -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="../tinymce/js/tinymce/tinymce.min.js"></script>
    <script src="../js/tinymce.js"></script>
    
    <script src="script.js"></script>
    <script>
      function onSubmit(token) {
        var reportType = document.getElementById("reportType").value;
        var senderName = document.getElementById("fullName").value;
        var email = document.getElementById("email").value;
        var phone = document.getElementById("phone").value;
        var content = document.getElementById("reportContent").value;
        var image1 = document.getElementById("image1").value;
        var image2 = document.getElementById("image2").value;

        // Gửi dữ liệu đến máy chủ
        fetch("http://localhost:3000/api/v1/report", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({
            reportType: reportType,
            senderName: senderName,
            email: email,
            phone: phone,
            content: content,
            image1: image1,
            image2: image2,
          }),
        })
          .then((response) => response.json())
          .then((data) => {
            // Xử lý phản hồi từ máy chủ nếu cần
            console.log(data);
            alert("Báo cáo đã được gửi thành công!");
          })
          .catch((error) => {
            // Xử lý lỗi nếu có
            console.error("Lỗi khi gửi dữ liệu: ", error);
          });
      }

      function validateForm() {
        // Kiểm tra reportType
        var reportType = document.getElementById("reportType").value;
        if (!reportType) {
          alert("Vui lòng chọn hình thức báo cáo");
          return false;
        }

        // Kiểm tra senderName
        var senderName = document.getElementById("fullName").value;
        if (!senderName) {
          alert("Vui lòng nhập họ và tên");
          return false;
        }

        // Kiểm tra email
        var email = document.getElementById("email").value;
        var emailRegex = /^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
        if (!email) {
          alert("Vui lòng nhập địa chỉ email");
          return false;
        } else if (!emailRegex.test(email)) {
          alert("Vui lòng nhập địa chỉ email hợp lệ");
          return false;
        }

        return true;
      }

      function submitForm() {
        if (validateForm()) {
          grecaptcha.execute();
        }
      }
    </script>
  </body>
</html>
